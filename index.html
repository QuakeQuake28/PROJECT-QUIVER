<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project QUIVER – Earthquake Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a8a;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #0f172a;
            --background: #fefefe;
            --surface: #ffffff;
            --surface-hover: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --accent-orange: #f97316;
            --accent-yellow: #f59e0b;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .brand-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .logo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
            display: block;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-fallback {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }

        .logo-fallback:hover {
            transform: scale(1.05);
        }

        .header .acronym {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
            font-style: italic;
            text-align: center;
            letter-spacing: 0.5px;
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 1.5rem 2rem;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .control-group label {
            font-size: 1rem;
            font-weight: 500;
            opacity: 0.95;
            min-width: 55px;
        }

        select {
            padding: 0.65rem 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.95);
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.95rem;
            font-family: 'Roboto', sans-serif;
            transition: all 0.2s ease;
        }

        select:hover, select:focus {
            background: white;
            border-color: rgba(255, 255, 255, 0.4);
            outline: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .disclaimer {
            background: linear-gradient(135deg, #fff8e1 0%, #fffbf0 100%);
            border: 1px solid #f3e5ab;
            border-left: 4px solid var(--warning);
            border-radius: 8px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);
        }

        .disclaimer-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .disclaimer-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--warning);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 0.8rem;
        }

        .disclaimer-title {
            font-weight: 700;
            font-size: 1rem;
            color: #92400e;
        }

        .disclaimer-text {
            color: #a16207;
            font-size: 0.9rem;
            line-height: 1.5;
            font-weight: 400;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 16px rgba(30, 58, 138, 0.08);
            text-align: center;
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(30, 58, 138, 0.15);
            border-color: var(--primary-light);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .map-section {
            background: var(--surface);
            border-radius: 12px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(30, 58, 138, 0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .map-header {
            background: var(--surface-hover);
            border-bottom: 1px solid var(--border-light);
            padding: 1.25rem 1.5rem;
        }

        .map-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        #map {
            width: 100%;
            height: 550px;
            border: none;
        }

        .info-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 16px rgba(30, 58, 138, 0.08);
        }

        .info-panel h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .info-panel p {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 1rem;
            font-weight: 400;
        }

        .phivolcs-note {
            background: #eff6ff;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .leaflet-popup-content-wrapper {
            background: white;
            border-radius: 12px;
            box-shadow: 0 16px 48px rgba(30, 58, 138, 0.2);
            border: 1px solid var(--border);
        }

        .leaflet-popup-content {
            margin: 0;
            font-family: 'Roboto', sans-serif;
        }

        .earthquake-popup {
            padding: 1.25rem;
            min-width: 280px;
        }

        .earthquake-popup h4 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0 0 1rem 0;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-light);
        }

        .popup-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0.6rem 0;
            font-size: 0.95rem;
        }

        .popup-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .popup-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        .location-text {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-light);
            color: var(--text-secondary);
            line-height: 1.4;
            font-size: 0.9rem;
        }

        .custom-legend {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 8px 24px rgba(30, 58, 138, 0.15);
            font-size: 0.9rem;
            max-width: 200px;
        }

        .legend-title {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .legend-subtitle {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            font-style: italic;
            font-weight: 300;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin: 0.5rem 0;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
        }

        .legend-text {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #dc2626;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            margin: 1rem 0;
            font-weight: 500;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .loading::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.75rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .leaflet-control-zoom a {
            background: var(--surface) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--border) !important;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.1) !important;
            font-weight: 700 !important;
        }

        .leaflet-control-zoom a:hover {
            background: var(--surface-hover) !important;
            border-color: var(--primary-light) !important;
        }

        @media (max-width: 768px) {
            .header {
                padding: 2rem 0;
            }

            .logo, .logo-fallback {
                width: 80px;
                height: 80px;
            }

            .logo-fallback {
                font-size: 2rem;
            }

            .header .acronym {
                font-size: 1rem;
            }
            
            .controls {
                flex-direction: column;
                gap: 1rem;
                padding: 1.25rem;
            }
            
            .control-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .main {
                padding: 1rem;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            #map {
                height: 450px;
            }
            
            .earthquake-popup {
                min-width: 250px;
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .logo, .logo-fallback {
                width: 70px;
                height: 70px;
            }

            .logo-fallback {
                font-size: 1.5rem;
            }

            .header .acronym {
                font-size: 0.9rem;
            }

            .stats {
                grid-template-columns: 1fr;
            }
            
            #map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="brand-section">
                <img src="LOGO.png" alt="QUIVER Logo" class="logo" 
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="logo-fallback" style="display: none;">QU</div>
                <div class="acronym">Quake Understanding through Interactive Visualization and Earthquake Research</div>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>Year:</label>
                    <select id="yearSelect">
                        <option value="2020">2020</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Month:</label>
                    <select id="monthSelect">
                        <option value="JAN">January</option>
                        <option value="FEB">February</option>
                        <option value="MAR">March</option>
                        <option value="APR">April</option>
                        <option value="MAY">May</option>
                        <option value="JUN">June</option>
                        <option value="JUL">July</option>
                        <option value="AUG">August</option>
                        <option value="SEP">September</option>
                        <option value="OCT">October</option>
                        <option value="NOV">November</option>
                        <option value="DEC">December</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="main">
        <div class="disclaimer">
            <div class="disclaimer-header">
                <div class="disclaimer-icon">!</div>
                <div class="disclaimer-title">Data Scope</div>
            </div>
            <div class="disclaimer-text">
                This visualization displays daily maximum seismic events recorded in the Philippines region. 
                Each data point represents the highest magnitude earthquake recorded on a given calendar day, 
                filtered from comprehensive seismic monitoring datasets.
            </div>
        </div>

        <div class="stats" id="statsContainer">
            <div class="stat-card">
                <div class="stat-value" id="maxMagnitude">0.0</div>
                <div class="stat-label">Max Magnitude</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgMagnitude">0.0</div>
                <div class="stat-label">Avg Magnitude</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maxDepth">0</div>
                <div class="stat-label">Max Depth (km)</div>
            </div>
        </div>

        <div class="map-section">
            <div class="map-header">
                <h3 class="map-title">Interactive Seismic Activity Map</h3>
            </div>
            <div id="map"></div>
        </div>

        <div class="info-panel">
            <h3>Data Source & Classification</h3>
            <p>
                This visualization displays the highest magnitude earthquake recorded each calendar day during the selected month, 
                based on seismic monitoring data from the Philippines region. Each marker represents the most significant seismic event 
                for that specific date in Philippine Standard Time.
            </p>
            <div class="phivolcs-note">
                <strong>Classification System:</strong> Magnitude ranges are based on general seismological standards. 
                The Philippines uses the PHIVOLCS Earthquake Intensity Scale (PEIS) for intensity measurements, 
                developed specifically for local geological conditions by the Philippine Institute of Volcanology and Seismology.
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([12.8797, 121.7740], 6);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        const legend = L.control({position: 'bottomright'});
        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'custom-legend');
            div.innerHTML = `
                <div class="legend-title">Magnitude Range</div>
                <div class="legend-subtitle">General Classification</div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #1e3a8a;"></div>
                    <span class="legend-text">≥ 6.0</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #f97316;"></div>
                    <span class="legend-text">5.0-5.9</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #f59e0b;"></div>
                    <span class="legend-text">4.0-4.9</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #3b82f6;"></div>
                    <span class="legend-text">< 4.0</span>
                </div>
            `;
            return div;
        };
        legend.addTo(map);

        let markers = [];

        function updateStats(data) {
            if (!data || data.length === 0) {
                document.getElementById('maxMagnitude').textContent = '0.0';
                document.getElementById('avgMagnitude').textContent = '0.0';
                document.getElementById('maxDepth').textContent = '0';
                return;
            }

            const magnitudes = data.map(eq => parseFloat(eq.magnitude) || 0);
            const depths = data.map(eq => parseFloat(eq.depth) || 0);

            document.getElementById('maxMagnitude').textContent = Math.max(...magnitudes).toFixed(1);
            document.getElementById('avgMagnitude').textContent = (magnitudes.reduce((a, b) => a + b, 0) / magnitudes.length).toFixed(1);
            document.getElementById('maxDepth').textContent = Math.max(...depths).toFixed(0);
        }

        function clearMarkers() {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
        }

        function getColor(magnitude) {
            if (magnitude >= 6) return '#1e3a8a';
            if (magnitude >= 5) return '#f97316';
            if (magnitude >= 4) return '#f59e0b';
            return '#3b82f6';
        }

        async function loadData() {
            const month = document.getElementById('monthSelect').value;
            const filename = `${month}2020.json`;
            
            clearMarkers();
            
            try {
                console.log(`Loading ${filename}...`);
                const response = await fetch(filename);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status} - File not found: ${filename}`);
                }
                
                const data = await response.json();
                
                if (!Array.isArray(data) || data.length === 0) {
                    throw new Error('No earthquake data found');
                }
                
                console.log(`✅ Successfully loaded ${data.length} earthquake records`);
                
                updateStats(data);
                
                data.forEach(eq => {
                    const lat = parseFloat(eq.latitude);
                    const lng = parseFloat(eq.longitude);
                    const mag = parseFloat(eq.magnitude) || 0;
                    
                    if (!lat || !lng) return;
                    
                    const marker = L.circleMarker([lat, lng], {
                        radius: Math.max(mag * 2.5, 6),
                        fillColor: getColor(mag),
                        color: '#ffffff',
                        weight: 2,
                        fillOpacity: 0.9
                    });
                    
                    const popupContent = `
                        <div class="earthquake-popup">
                            <h4>Magnitude ${mag} Earthquake</h4>
                            <div class="popup-row">
                                <span class="popup-label">Date:</span>
                                <span class="popup-value">${eq.date}</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Depth:</span>
                                <span class="popup-value">${eq.depth} km</span>
                            </div>
                            <div class="popup-row">
                                <span class="popup-label">Coordinates:</span>
                                <span class="popup-value">${lat.toFixed(2)}°N, ${lng.toFixed(2)}°E</span>
                            </div>
                            <div class="location-text">
                                <strong>Location:</strong><br>
                                ${eq.location}
                            </div>
                        </div>
                    `;
                    
                    marker.bindPopup(popupContent);
                    marker.addTo(map);
                    markers.push(marker);
                });
                
                if (markers.length > 0) {
                    const group = new L.featureGroup(markers);
                    map.fitBounds(group.getBounds().pad(0.1));
                }
                
            } catch (error) {
                console.error('❌ Error:', error);
                updateStats([]);
                
                document.getElementById('map').innerHTML = `
                    <div class="error">
                        <h3>Cannot load ${filename}</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Expected files:</strong> JAN2020.json, FEB2020.json, MAR2020.json, APR2020.json, MAY2020.json, JUN2020.json, JUL2020.json, AUG2020.json, SEP2020.json, OCT2020.json, NOV2020.json, DEC2020.json</p>
                        <p><em>Make sure all JSON files are uploaded to your repository root.</em></p>
                    </div>
                `;
            }
        }

        document.getElementById('monthSelect').addEventListener('change', loadData);
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('QUIVER Earthquake Visualization - Loading...');
            setTimeout(loadData, 300);
        });
    </script>
</body>
</html>